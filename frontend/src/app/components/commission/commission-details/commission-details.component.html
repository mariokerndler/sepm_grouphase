<div *ngIf="hasLoaded">
  <div class="primary title">
    <div fxFlex fxLayout>
      <button class="back-arrow" mat-icon-button routerLink="/commissions">
        <mat-icon class="back-icon">keyboard_arrow_left</mat-icon>
      </button>
    </div>
    <h2>Commission: {{commission.title}}</h2>
    <div class="navigation-items" fxFlex fxLayout fxLayoutAlign="end"></div>
  </div>
  <div class="primary total">
    <div class="profile" fxLayout="column">
      <img [src]="userProfilePicture" alt="" class="commission-pfp">
      <br>
      <strong class="userName">{{user.userName}}</strong>
    </div>
    <div class="description">
      <strong>Description:</strong>
      <br><br>
      <div class="description-section">
      <p>{{commission.instructions}}</p>
      </div>
      <br>
      <div class="description-section">
        <strong>Commissioned by:</strong>    <br><br>
        <p>{{commission.customerDto.userName}}</p>
      </div>
      <br>
      <div *ngIf="hasReferences">
        <strong class="referenceImages">Reference Images:</strong>
      <br><br>
        <div class="scrolling-container">
          <cdk-virtual-scroll-viewport orientation="horizontal" itemSize="{{commission.referencesDtos.length}}" class="viewport">
            <div class="image-container" *ngFor="let reference of commission.referencesDtos; let i = index">
              <img class="gallery-pictures" (click)="setSelectedArtwork(i) " [src]="'/assets/' + reference.imageUrl" alt="">
            </div>
          </cdk-virtual-scroll-viewport>
        </div>
        <app-gallery-carousel
          (closeCarousel)="selectedArtwork=null"
          *ngIf="selectedArtwork!== null"
          [artworks]="commission.referencesDtos"
          [selectedArtworkId]="selectedArtwork">
        </app-gallery-carousel>
      </div>
      <div *ngIf="hasSketches">
        <strong class="referenceImages">Reference Images:</strong>
        <br><br>
        <div class="scrolling-container">
          <cdk-virtual-scroll-viewport orientation="horizontal" itemSize="{{commission.artworkDto.sketchesDtos.length}}" class="viewport">
            <div class="image-container" *ngFor="let reference of commission.artworkDto.sketchesDtos; let i = index">
              <img class="gallery-pictures" (click)="setSelectedArtwork(i) " [src]="'/assets/' + reference.imageUrl" alt="">
            </div>
          </cdk-virtual-scroll-viewport>
        </div>
        <app-gallery-carousel
          (closeCarousel)="selectedArtwork=null"
          *ngIf="selectedArtwork!== null"
          [artworks]="commission.artworkDto.sketchesDtos"
          [selectedArtworkId]="selectedArtwork">
        </app-gallery-carousel>
      </div>
      <br><br>
      <strong>Feedback-Rounds: {{commission.feedbackRounds}}</strong> <br><br>
        <strong class="status">Status: {{commission.status.replace('_',' ')}}</strong>
      <br><br>
      <strong >Price: ${{commission.price}}</strong>
      <br><br>
      <strong >Date: {{commission.issueDate.substring(0,11)}}
        - {{commission.deadlineDate.substring(0,11)}}</strong>
      <div *ngIf="this.uploadedSketchDto"   fxLayoutAlign="center center"  >
        <div><mat-label>Sketch</mat-label></div>
      <div><img   [src]="this.uploadedSketchDto.imageData" alt="" class="preview-image" ></div>
        <div><input matInput type="text"></div>
      </div>
    </div>
    <div *ngIf="commission.status.toString()==='LISTED' && this.commission.customerDto.id.toString() !== this.userId">
    <button class="accept" color="primary" fxLayoutAlign="center" mat-flat-button>Apply</button>
    </div>
    <div *ngIf="commission.status.toString()==='IN_PROGRESS'&& artistEdit && allowSketch" >
      <form [formGroup]="sketchForm" fxLayout="row" fxLayoutAlign="center end">
        <div>
        <button (click)="fileInput.click()"  color="accent" mat-button>
          <input   #fileInput (change)="fileSelected($event)"
                   accept=".png,.jpg,.gif,.jpeg" style="display: none;"    type="file">
        <mat-icon color="accent">upload</mat-icon>
        <span>Upload new Sketch</span>
      </button>
        </div>
        <div *ngIf="this.uploadedSketchDto"  >
          <button  (click)="updateCommission()"   color="primary"  mat-flat-button>Confirm  Upload</button>
        </div>
      </form>
    </div>
    <div *ngIf="commission.status.toString()==='IN_PROGRESS'&& userEdit && allowFeedback">
      <button class="accept" color="primary" fxLayoutAlign="center" mat-flat-button>Upload Feedback</button>
    </div>

  </div>
</div>
